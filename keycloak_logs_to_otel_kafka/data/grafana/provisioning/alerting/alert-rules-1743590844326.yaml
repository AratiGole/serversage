apiVersion: 1
groups:
    - orgId: 1
      name: 5m
      folder: Alerts
      interval: 5m
      rules:
        - uid: ceh4diorrrfuoc
          title: Node Down
          condition: B
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: fe00f6cf-2f52-4c61-af0b-dd0dbbb730de
              model:
                disableTextWrap: false
                editorMode: code
                expr: group by(instance, job) (up)
                fullMetaSearch: false
                includeNullMetadata: true
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
                useBackend: false
            - refId: B
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0.5
                        type: lt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                      unloadEvaluator:
                        params:
                            - 0.5
                        type: gt
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                refId: B
                type: threshold
          noDataState: NoData
          execErrState: Error
          for: 20m
          annotations:
            description: Triggered when the node is unreachable (up{} == 0 for 5 minutes)
            summary: Triggered when the node is unreachable (up{} == 0 for 5 minutes)
          isPaused: false
          notification_settings:
            receiver: grafana-default-email
    - orgId: 1
      name: Alert
      folder: Servers/Linux
      interval: 5m
      rules:
        - uid: fegsoipfj8p34b
          title: High CPU Utilization
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: fe00f6cf-2f52-4c61-af0b-dd0dbbb730de
              model:
                disableTextWrap: false
                editorMode: code
                exemplar: false
                expr: 100 * (1 - avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[$__rate_interval])))
                format: time_series
                fullMetaSearch: false
                includeNullMetadata: false
                instant: true
                intervalMs: 1000
                legendFormat: ""
                maxDataPoints: 43200
                range: false
                refId: A
                useBackend: false
            - refId: C
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 60
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                      unloadEvaluator:
                        params:
                            - 60
                        type: lt
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: rYdddlPWk
          panelId: 20
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            __dashboardUid__: rYdddlPWk
            __panelId__: "20"
            description: The CPU utilisation of instance {{ $labels.instance }} has been above 60 %  for the last 5 minutes, current value is  {{ $values.A }} %.
            summary: High CPU usage detected on instance {{ $labels.instance }}
          labels:
            severity: critical
            team: infra
          isPaused: false
          notification_settings:
            receiver: grafana-default-email
            group_by:
                - grafana_folder
                - alertname
        - uid: aegzz9ltwderkb
          title: High System Load
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: fe00f6cf-2f52-4c61-af0b-dd0dbbb730de
              model:
                adhocFilters: []
                datasource:
                    type: prometheus
                    uid: fe00f6cf-2f52-4c61-af0b-dd0dbbb730de
                editorMode: code
                exemplar: false
                expr: avg(scalar(node_load1{job="node-exporter", instance="192.168.137.212:9100"}) * 100 / count by (cpu) (node_cpu_seconds_total{job="node-exporter", instance="192.168.137.212:9100"}))
                format: time_series
                instant: true
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                maxDataPoints: 43200
                range: false
                refId: A
                step: 240
            - refId: C
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 80
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                      unloadEvaluator:
                        params:
                            - 80
                        type: lt
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: rYdddlPWk
          panelId: 155
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            __dashboardUid__: rYdddlPWk
            __panelId__: "155"
            description: System Load has exceeded 80% for the last 5 minutes.
            summary: 'The System Load of instance  has been above 80% for the last 5 minutes. Current Value: {{ $values.A }} %'
          labels:
            instance: 192.168.137.212:9100
          isPaused: false
          notification_settings:
            receiver: grafana-default-email
        - uid: eeh4bcy3hs740f
          title: High Memory Usage
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: fe00f6cf-2f52-4c61-af0b-dd0dbbb730de
              model:
                disableTextWrap: false
                editorMode: code
                expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes)/ (node_memory_MemTotal_bytes ) * 100
                fullMetaSearch: false
                includeNullMetadata: true
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
                useBackend: false
            - refId: C
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 85
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                      unloadEvaluator:
                        params:
                            - 82
                        type: lt
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: rYdddlPWk
          panelId: 156
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            __dashboardUid__: rYdddlPWk
            __panelId__: "156"
            description: The memory usage on this node has exceeded the defined threshold above 85%. Please investigate immediately.
            summary: "Suggested Actions:\n1. Check the processes consuming the most memory using tools like `top` or `htop`.\n2. Review application logs for memory leaks or excessive memory allocation.\n3. Consider restarting the application or service if necessary.\n4. If the problem persists, evaluate the need for additional memory resources.  \nTroubleshooting:\n*   Connect to the instance: `ssh {{ $labels.instance }}`\n*   Check memory usage: `free -m` or `htop`\n\nPlease take immediate action to resolve this issue."
          isPaused: false
          notification_settings:
            receiver: grafana-default-email
    - orgId: 1
      name: 1m
      folder: Services/Postgres
      interval: 5m
      rules:
        - uid: eeh0569lv2j28e
          title: PostgreSQL Database Down
          condition: B
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: fe00f6cf-2f52-4c61-af0b-dd0dbbb730de
              model:
                disableTextWrap: false
                editorMode: code
                expr: pg_up
                fullMetaSearch: false
                includeNullMetadata: true
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
                useBackend: false
            - refId: B
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0.5
                        type: lt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                      unloadEvaluator:
                        params:
                            - 0.5
                        type: gt
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                refId: B
                type: threshold
          dashboardUid: "000000039"
          panelId: 36
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            __dashboardUid__: "000000039"
            __panelId__: "36"
            description: "Instance: {{ $labels.instance }}  \njob: {{ $labels.job }}  \nTimestamp: {{ $time }}  \nDetails: The PostgreSQL instance is currently not reachable. The `pg_up` metric has reported a value of 0, indicating that the database is down."
            summary: Database is down for instance {{ $labels.instance }}
          isPaused: false
          notification_settings:
            receiver: grafana-default-email
